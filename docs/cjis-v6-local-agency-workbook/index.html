<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CJIS v6.0 Local Agency Self-Assessment Workbook (Unofficial)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --bg: #f3f4f6;
            --card: #ffffff;
            --border: #d1d5db;
            --accent: #0b61a4;
            --accent-soft: #e0f2fe;
            --accent-strong: #0b61a4;
            --text-main: #111827;
            --text-muted: #4b5563;
            --danger: #b91c1c;
            --warning: #f59e0b;
            --success: #16a34a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top left, #dbeafe, #f3f4f6);
            color: var(--text-main);
        }

        .page {
            max-width: 1300px;
            margin: 16px auto 32px auto;
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(300px, 1.2fr);
            gap: 16px;
            padding: 0 12px;
        }

        @media (max-width: 1000px) {
            .page {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .main-card,
        .side-card {
            background: var(--card);
            border-radius: 14px;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.15);
            border: 1px solid rgba(148, 163, 184, 0.4);
            overflow: hidden;
        }

        .main-card-header {
            padding: 18px 20px 14px 20px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #0f172a, #1d4ed8);
            color: #f9fafb;
            position: relative;
        }

        .main-card-header::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 10% 0%, rgba(59, 130, 246, 0.4), transparent 50%);
            opacity: 0.8;
            pointer-events: none;
        }

        .main-card-header-inner {
            position: relative;
            z-index: 1;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(148, 163, 184, 0.8);
            color: #e5e7eb;
            margin-bottom: 6px;
        }

        .badge span {
            font-size: 12px;
        }

        .audit-title {
            font-size: 1.4rem;
            margin: 0 0 2px 0;
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .audit-title span {
            font-size: 0.9rem;
            font-weight: 400;
            color: #e5e7eb;
        }

        .header-sub {
            font-size: 0.83rem;
            color: #e5e7eb;
            opacity: 0.95;
        }

        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 6px;
            font-size: 0.78rem;
        }

        .tag {
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.8);
        }

        .main-card-body {
            padding: 16px 20px 16px 20px;
        }

        .side-card-header {
            padding: 12px 14px 10px 14px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(90deg, #0f172a, #1d4ed8);
            color: #f9fafb;
            position: relative;
        }

        .side-card-header h2 {
            margin: 0;
            font-size: 1rem;
        }

        .side-card-header p {
            margin: 3px 0 0 0;
            font-size: 0.78rem;
            opacity: 0.9;
        }

        .side-card-body {
            padding: 12px 14px 14px 14px;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            margin-bottom: 10px;
        }

        .toolbar-left,
        .toolbar-right {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .toolbar-right {
            margin-left: auto;
        }

        @media (max-width: 700px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-right {
                margin-left: 0;
                justify-content: space-between;
            }
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #e5e7eb;
            color: #111827;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1d4ed8, #0b61a4);
            color: white;
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #d1d5db;
            color: #111827;
        }

        .btn-ghost {
            background: transparent;
            color: #374151;
        }

        .btn-small {
            padding: 4px 10px;
            font-size: 11px;
        }

        .btn-icon {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .btn-primary:hover {
            filter: brightness(1.05);
        }

        .btn-outline:hover {
            background: #f3f4f6;
        }

        .btn-ghost:hover {
            background: #f9fafb;
        }

        .pill {
            border-radius: 999px;
            border: 1px solid #d1d5db;
            padding: 4px 10px;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #f9fafb;
            color: #374151;
        }

        .pill-label {
            font-weight: 600;
            color: #111827;
        }

        .pill-value {
            color: #2563eb;
        }

        .pill-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #22c55e;
        }

        .pill-dot.warning {
            background: #f97316;
        }

        .pill-dot.danger {
            background: #ef4444;
        }

        .pill-dot.muted {
            background: #9ca3af;
        }

        .pill-soft {
            background: #eff6ff;
            border-color: #bfdbfe;
            color: #1d4ed8;
        }

        .tab-row {
            display: flex;
			flex-wrap: wrap;
			row-gap: 8px; 
            gap: 6px;
            margin-bottom: 10px;
        }

        .tab {
            flex: 0 0 auto;
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 999px;
            cursor: pointer;
            border: 1px solid transparent;
            background: #f3f4f6;
            color: #4b5563;
        }

        .tab.active {
            background: #0b61a4;
            color: white;
            border-color: #0b61a4;
        }

        .section {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 12px;
            margin-bottom: 10px;
            background: #f9fafb;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #111827;
        }

        .section-sub {
            font-size: 0.75rem;
            color: #6b7280;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chip {
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 0.7rem;
            border: 1px solid #d1d5db;
            background: #f3f4f6;
        }

        .chip-accent {
            border-color: #bfdbfe;
            background: #e0f2fe;
            color: #075985;
        }

        .chip-soft {
            border-color: #e5e7eb;
            background: #f9fafb;
            color: #4b5563;
        }

        .inline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 6px;
            margin-top: 6px;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .field-label {
            font-size: 0.72rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .field-label span {
            font-weight: 600;
            color: #111827;
        }

        .field-required {
            color: #b91c1c;
            font-size: 0.7rem;
        }

        .field-help {
            font-size: 0.7rem;
            color: #9ca3af;
        }

        input[type="text"],
        input[type="date"],
        select,
        textarea {
            font-family: inherit;
            font-size: 0.8rem;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            background: white;
            color: #111827;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #1d4ed8;
            box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
        }

        .small-input {
            max-width: 200px;
        }

        .micro-input {
            max-width: 100px;
        }

        .flex-row {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .flex-space {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .status-pill {
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 0.72rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-pill span {
            width: 7px;
            height: 7px;
            border-radius: 999px;
        }

        .status-ok {
            background: #dcfce7;
            color: #166534;
        }

        .status-ok span {
            background: #16a34a;
        }

        .status-watch {
            background: #fef3c7;
            color: #92400e;
        }

        .status-watch span {
            background: #f59e0b;
        }

        .status-risk {
            background: #fee2e2;
            color: #b91c1c;
        }

        .status-risk span {
            background: #ef4444;
        }

        .status-neutral {
            background: #e5e7eb;
            color: #374151;
        }

        .status-neutral span {
            background: #6b7280;
        }

        .switch-row {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .switch {
            width: 34px;
            height: 18px;
            border-radius: 999px;
            background: #e5e7eb;
            position: relative;
            transition: background 0.2s;
        }

        .switch-thumb {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 999px;
            background: white;
            top: 2px;
            left: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.25);
            transition: transform 0.2s;
        }

        .switch.on {
            background: #22c55e;
        }

        .switch.on .switch-thumb {
            transform: translateX(16px);
        }

        .check-row {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.78rem;
        }

        .check-row input[type="checkbox"] {
            width: 13px;
            height: 13px;
        }

        .side-section {
            margin-bottom: 10px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 8px 9px 9px 9px;
            background: #f9fafb;
        }

        .side-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .side-section-title {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .side-section-sub {
            font-size: 0.7rem;
            color: #6b7280;
        }

        .metric-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .metric-label {
            color: #4b5563;
        }

        .metric-value {
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            border-radius: 999px;
            background: #e5e7eb;
            overflow: hidden;
            margin-top: 3px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #22c55e, #84cc16);
            border-radius: 999px;
            transition: width 0.2s ease-out;
        }

        .risk-bar {
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: #fee2e2;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #f97316, #b91c1c);
            border-radius: 999px;
            transition: width 0.2s ease-out;
        }

        .phase-row {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 0.72rem;
        }

        .phase-badge {
            padding: 2px 7px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .phase-badge span {
            font-size: 0.7rem;
            color: #6b7280;
        }

        .help-text {
            font-size: 0.7rem;
            color: #6b7280;
        }

        .help-text strong {
            color: #111827;
        }

        .list-compact {
            margin: 4px 0 0 16px;
            padding: 0;
            font-size: 0.78rem;
            color: #4b5563;
        }

        .list-compact li {
            margin-bottom: 2px;
        }

        .pill-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 0.72rem;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .pill-status-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
        }

        .pill-status-ok .pill-status-dot {
            background: #16a34a;
        }

        .pill-status-warn .pill-status-dot {
            background: #f59e0b;
        }

        .pill-status-risk .pill-status-dot {
            background: #ef4444;
        }

        .pill-status-muted .pill-status-dot {
            background: #9ca3af;
        }

        .no-print {
            /* placeholder for print styles if needed */
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            margin-bottom: 6px;
        }

        .form-row small {
            font-size: 0.72rem;
            color: #6b7280;
        }

        .audit-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }

        .audit-controls label {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .audit-controls input[type="radio"] {
            width: 13px;
            height: 13px;
        }

        .small-pill {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .badge-soft {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 8px;
            border-radius: 999px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            font-size: 0.72rem;
            color: #1d4ed8;
        }

        .badge-soft span {
            font-size: 0.8rem;
        }

        .key-metric {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 0.78rem;
        }

        .key-metric-label {
            color: #6b7280;
        }

        .key-metric-value {
            font-weight: 600;
        }

        .table-compact {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.78rem;
            margin-top: 6px;
        }

        .table-compact th,
        .table-compact td {
            border: 1px solid #e5e7eb;
            padding: 4px 6px;
            text-align: left;
        }

        .table-compact th {
            background: #f3f4f6;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .tag-soft {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 7px;
            border-radius: 999px;
            background: #eff6ff;
            color: #1d4ed8;
            font-size: 0.7rem;
        }

        .tag-soft span {
            font-size: 0.8rem;
        }

        .tag-soft.neutral {
            background: #f3f4f6;
            color: #4b5563;
        }

        .tag-soft.red {
            background: #fee2e2;
            color: #b91c1c;
        }

        .tag-soft.green {
            background: #dcfce7;
            color: #166534;
        }

        .tag-soft.yellow {
            background: #fef3c7;
            color: #92400e;
        }

        .tag-soft.blue {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .text-muted {
            color: #6b7280;
            font-size: 0.78rem;
        }

        .metric-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 7px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            font-size: 0.72rem;
        }

        .metric-chip strong {
            font-weight: 600;
        }

        .metric-chip span {
            color: #6b7280;
        }

        .pill-cjis {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid rgba(129, 140, 248, 0.6);
            background: rgba(129, 140, 248, 0.06);
            color: #1d4ed8;
            font-size: 0.7rem;
        }

        .pill-cjis-code {
            font-weight: 600;
        }

        .pill-cjis-area {
            color: #6b7280;
        }

        .pill-cjis-dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: #4f46e5;
        }

        .badge-light {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 999px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            font-size: 0.72rem;
            color: #374151;
        }

        .badge-light span {
            font-size: 0.8rem;
        }

        .pill-text {
            font-size: 0.72rem;
            color: #6b7280;
        }

        .section-note {
            margin-top: 4px;
            font-size: 0.7rem;
            color: #6b7280;
        }

        .print-note {
            font-size: 0.7rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .toast {
            position: fixed;
            bottom: 16px;
            right: 16px;
            background: #111827;
            color: #f9fafb;
            padding: 10px 14px;
            border-radius: 999px;
            font-size: 0.8rem;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.6);
            z-index: 50;
        }

        .toast.show {
            display: inline-flex;
        }

        .toast-icon {
            width: 20px;
            height: 20px;
            border-radius: 999px;
            background: #22c55e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .toast-text {
            white-space: nowrap;
        }

        .requirement-row {
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            padding: 7px 8px;
            margin-bottom: 6px;
        }

        .requirement-header {
            display: flex;
            gap: 6px;
            align-items: center;
            margin-bottom: 4px;
        }

        .requirement-title {
            font-size: 0.8rem;
            font-weight: 600;
            flex: 1;
        }

        .requirement-id {
            font-size: 0.72rem;
            color: #6b7280;
        }

        .requirement-body {
            display: grid;
            grid-template-columns: minmax(0, 2.2fr) minmax(0, 2fr);
            gap: 6px;
        }

        @media (max-width: 900px) {
            .requirement-body {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .requirement-notes {
            font-size: 0.75rem;
            color: #4b5563;
        }

        .requirement-notes textarea {
            font-size: 0.75rem;
            min-height: 50px;
        }

        .requirement-controls {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-items: center;
        }

        .status-select {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
        }

        .evidence-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 0.7rem;
        }

        .evidence-tag {
            padding: 2px 7px;
            border-radius: 999px;
            border: 1px dashed #cbd5f5;
            color: #4b5563;
            background: #eff6ff;
        }

        .evidence-tag strong {
            color: #1d4ed8;
        }

        .link-like {
            color: #2563eb;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            font-size: 0.75rem;
        }

        .link-like:hover {
            color: #1d4ed8;
        }

        .summary-section {
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e5ea;
        }

        .summary-section h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #1f2933;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 10px;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 14px 16px;
            border-radius: 8px;
            border-left: 4px solid #0b61a4;
            font-size: 12px;
            color: #4b5563;
        }

        .summary-card h4 {
            font-size: 13px;
            margin-bottom: 8px;
            color: #111827;
        }

        .summary-card-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
        }

        .summary-card-row span:first-child {
            color: #6b7280;
        }

        .summary-card-row span:last-child {
            font-weight: 600;
        }

        .summary-completion {
            margin-top: 8px;
            font-weight: 600;
            color: #111827;
            font-size: 12px;
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 40;
        }

        .modal {
            background: #f9fafb;
            border-radius: 12px;
            max-width: 620px;
            width: 94%;
            padding: 12px 16px 14px 16px;
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.6);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .modal-title {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .modal-close {
            border-radius: 999px;
            background: transparent;
            border: 1px solid #e5e7eb;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .modal-body {
            font-size: 0.8rem;
            color: #4b5563;
        }

        .modal-body h4 {
            font-size: 0.85rem;
            margin: 10px 0 3px 0;
        }

        .modal-body ul {
            margin: 3px 0 0 16px;
            padding: 0;
        }

        .modal-body li {
            margin-bottom: 2px;
        }

        .badge-inline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 7px;
            border-radius: 999px;
            font-size: 0.7rem;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .badge-inline span {
            width: 6px;
            height: 6px;
            border-radius: 999px;
        }

        .badge-inline.critical span {
            background: #b91c1c;
        }

        .badge-inline.high span {
            background: #eab308;
        }

        .badge-inline.medium span {
            background: #0ea5e9;
        }

        .badge-inline.low span {
            background: #22c55e;
        }

        .badge-inline.critical {
            color: #b91c1c;
        }

        .badge-inline.high {
            color: #92400e;
        }

        .badge-inline.medium {
            color: #075985;
        }

        .badge-inline.low {
            color: #166534;
        }

        .pill-light {
            padding: 1px 7px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            font-size: 0.7rem;
            color: #4b5563;
        }

        .text-sm {
            font-size: 0.78rem;
        }

        .mt-4 {
            margin-top: 6px;
        }

        .mt-2 {
            margin-top: 3px;
        }

        .code-inline {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.75rem;
            background: #f3f4f6;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.72rem;
        }

        .indicator-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
        }

        .indicator.ok .indicator-dot {
            background: #22c55e;
        }

        .indicator.warn .indicator-dot {
            background: #facc15;
        }

        .indicator.risk .indicator-dot {
            background: #ef4444;
        }

        .indicator-label {
            color: #4b5563;
        }

        .logic-diagram {
            margin-top: 6px;
            padding: 8px 9px;
            background: #f3f4f6;
            border-radius: 8px;
            font-size: 0.75rem;
            color: #374151;
            border: 1px dashed #d1d5db;
        }

        .logic-diagram strong {
            color: #111827;
        }

        .logic-step {
            display: flex;
            gap: 4px;
            align-items: flex-start;
            margin-bottom: 2px;
        }

        .logic-step span {
            font-weight: 600;
            color: #6b7280;
        }
    </style>
</head>
<body>
<div class="page">
    <div class="main-card">
        <div class="main-card-header">
            <div class="main-card-header-inner">
                <div class="badge">
                    <span>üîê</span>
                    <span>CJIS v6.0 ‚Äì Local Agency Assessment Workbook</span>
                </div>
                <h1 class="audit-title">
                    CJIS Security Policy ‚Äì Local Agency Audit
                    <span>Working copy ‚Äì not an official FBI / CSA form</span>
                </h1>
                <div class="header-sub">
                    Use this page to capture assessment notes and status for a local agency‚Äôs CJIS v6.0 readiness / pre-audit preparation. Progress can be saved locally, exported to JSON, or printed.
                </div>
                <div class="section" id="disclaimer" style="margin-top:10px; background:#fff7ed; border-color:#fed7aa;">
                    <div class="section-header">
                        <div class="section-title">Important: Unofficial tool + local-only storage</div>
                        <div class="section-sub"><span class="chip chip-accent">Read before use</span></div>
                    </div>
                    <div class="help-text" style="font-size:0.78rem; color:#7c2d12;">
                        <ul class="list-compact" style="color:#7c2d12; font-size:0.78rem;">
                            <li><strong>Unofficial resource:</strong> Not an FBI/CSA form and not endorsed by the FBI, CJIS Division, or any state CSA.</li>
                            <li><strong>No CJI:</strong> Do not enter Criminal Justice Information (CJI) or other sensitive case data into this workbook.</li>
                            <li><strong>Storage:</strong> ‚ÄúSave Session‚Äù uses your browser‚Äôs <span class="code-inline">localStorage</span> on this device. It is <strong>not encrypted</strong>. Don‚Äôt use on shared/public computers.</li>
                            <li><strong>Authority:</strong> Your CSA/state CJIS office guidance is the authoritative source for audit requirements and interpretations.</li>
                            <li><strong>Official CJIS policy reference:</strong> <a href="https://le.fbi.gov/file-repository/cjis_security_policy_v6-0_20241227.pdf/view" target="_blank" rel="noopener noreferrer">CJIS Security Policy v6.0 (FBI landing page)</a></li>
                        </ul>
                    </div>
                </div>

                <div class="tag-row">
                    <div class="tag">Policy Area 1‚Äì13 Coverage</div>
                    <div class="tag">Local Agency / ORI-Level Assessment</div>
                    <div class="tag">Supports TAC / LASO pre-audit prep</div>
                </div>
            </div>
        </div>
        <div class="main-card-body">
            <div class="toolbar">
                <div class="toolbar-left">
                    <button class="btn btn-primary" onclick="saveState()">
                        üíæ Save Session (Browser)
                    </button>
                    <button class="btn btn-outline" onclick="resetState()">
                        ‚ôªÔ∏è Clear All
                    </button>
                    
                    <button class="btn btn-outline" onclick="exportJSON()">‚¨áÔ∏è Export JSON</button>
                    <button class="btn btn-outline" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Import JSON</button>
                    <input type="file" id="importFile" accept="application/json" style="display:none" onchange="importJSON(event)">
                    <button class="btn btn-ghost" onclick="window.print()">
                        üñ®Ô∏è Print / PDF Export
                    </button>
                </div>
                <div class="toolbar-right">
                    <div class="pill">
                        <div class="pill-dot" id="overallStatusDot"></div>
                        <span class="pill-label">Overall Status:</span>
                        <span class="pill-value" id="overallStatusLabel">Not started</span>
                    </div>
                    <div class="pill-soft">
                        <span>üìÖ</span>
                        <span id="lastUpdatedLabel">Last updated: not yet saved</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">1. Local Agency & Scope</div>
                    <div class="section-sub">
                        <span class="chip chip-soft">Context & identifiers</span>
                    </div>
                </div>
                <div class="inline-grid">
                    <div class="field-group">
                        <div class="field-label"><span>Agency Name</span> <span class="field-required">*</span></div>
                        <input type="text" id="agencyName" placeholder="e.g., Sample City Police Department">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>ORI</span> <span class="field-required">*</span></div>
                        <input type="text" id="ori" placeholder="e.g., TX1234567">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>CSA / State</span></div>
                        <input type="text" id="csa" placeholder="e.g., Texas DPS (CSA)">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>Assessment Date</span></div>
                        <input type="date" id="assessmentDate">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>Assessor</span></div>
                        <input type="text" id="assessorName" placeholder="Name(s) of assessor(s)">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>Contact Email</span></div>
                        <input type="text" id="assessorEmail" placeholder="Primary contact for follow-up">
                    </div>
                </div>
                <div class="form-row">
                    <div class="field-group" style="flex: 2 1 260px;">
                        <div class="field-label"><span>Scope Notes</span></div>
                        <textarea id="scopeNotes"
                                  placeholder="Briefly describe scope ‚Äì systems, locations, any exclusions or special circumstances."></textarea>
                        <div class="field-help">
                            Helpful for documenting what is (and is not) in-scope for CJIS: CAD, RMS, NCIC/TCIC terminals, MDTs, JMS, records, etc.
                        </div>
                    </div>
                    <div class="field-group" style="flex: 1 1 200px;">
                        <div class="field-label"><span>Assessment Type</span></div>
                        <select id="assessmentType">
                            <option value="">Select type</option>
                            <option value="self">Agency self-assessment</option>
                            <option value="preaudit">Pre-audit (TAC / LASO prep)</option>
                            <option value="csa">CSA-led assessment or audit</option>
                            <option value="consult">Third-party / consulting support</option>
                        </select>
                        <div class="field-help">
                            Adjust language in notes to match purpose (formal vs. informal).
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">2. Governance & Key Contacts</div>
                    <div class="section-sub">
                        <span class="chip chip-accent">Policy Area 1, 2, 11, 12</span>
                    </div>
                </div>
                <div class="inline-grid">
                    <div class="field-group">
                        <div class="field-label"><span>TAC (Terminal Agency Coordinator)</span></div>
                        <input type="text" id="tacName" placeholder="Name and rank/position">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>TAC Contact</span></div>
                        <input type="text" id="tacContact" placeholder="Phone / email">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>LASO (Local Agency Security Officer)</span></div>
                        <input type="text" id="lasoName" placeholder="Name and rank/position">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>LASO Contact</span></div>
                        <input type="text" id="lasoContact" placeholder="Phone / email">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>IT / ISO Lead</span></div>
                        <input type="text" id="itLead" placeholder="Name / title for IT or ISO">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>IT / ISO Contact</span></div>
                        <input type="text" id="itContact" placeholder="Phone / email">
                    </div>
                </div>
                <div class="inline-grid" style="margin-top: 6px;">
                    <div class="field-group">
                        <div class="field-label">
                            <span>TAC & LASO Appointments</span>
                        </div>
                        <div class="audit-controls">
                            <label><input type="radio" name="tacLasoDocs" value="present"> Documented & current</label>
                            <label><input type="radio" name="tacLasoDocs" value="partial"> Partial / needs update</label>
                            <label><input type="radio" name="tacLasoDocs" value="missing"> Not available</label>
                        </div>
                        <div class="field-help">
                            Letters, emails, or orders that formally appoint TAC and LASO roles.
                        </div>
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>Local CJIS Security Policy / SOPs</span></div>
                        <div class="audit-controls">
                            <label><input type="radio" name="localPolicy" value="aligned"> Aligned with CJIS v6.0</label>
                            <label><input type="radio" name="localPolicy" value="dated"> Outdated / needs revision</label>
                            <label><input type="radio" name="localPolicy" value="missing"> Not documented</label>
                        </div>
                    </div>
                </div>
                <div class="section-note">
                    <span class="link-like" onclick="openControlModal('governance')">View suggested governance evidence</span>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">3. CJIS Policy Areas ‚Äì Assessment by Control</div>
                    <div class="section-sub">
                        <span class="chip chip-accent">Policy Area 1‚Äì13</span>
                    </div>
                </div>
                <div class="help-text">
                    Use the controls below to track status by policy area. The main goal is to capture practical status for the local agency:
                    how each control is implemented, any gaps, and follow-up actions.
                </div>
                <div class="tab-row" id="policyTabs"></div>
                <div id="policyContent"></div>
            </div>

            <div class="summary-section">
                <h3>Policy Area Summary</h3>
                <div class="summary-grid" id="summaryGrid"></div>
            </div>
        </div>
    </div>
    <div class="side-card">
        <div class="side-card-header">
            <h2>Assessment Snapshot & Notes</h2>
            <p>Quick metrics, risk overview, and planning notes for follow-up.</p>
        </div>
        <div class="side-card-body">
            <div class="side-section">
                <div class="side-section-header">
                    <div class="side-section-title">Overall Progress & Risk</div>
                    <div class="side-section-sub">
                        <span id="snapshotStatusTag" class="tag-soft neutral">Not started</span>
                    </div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Controls with any status</span>
                    <span class="metric-value" id="metricComplete">0 / 0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="metric-row" style="margin-top: 6px;">
                    <span class="metric-label">Controls flagged Non-Compliant</span>
                    <span class="metric-value" id="metricNonCompliant">0</span>
                </div>
                <div class="risk-bar">
                    <div class="risk-fill" id="riskFill"></div>
                </div>
                <div class="phase-row" style="margin-top: 6px;">
                    <div class="phase-badge">
                        <span>1</span> Identify & scope
                    </div>
                    <div class="phase-badge">
                        <span>2</span> Gather evidence
                    </div>
                    <div class="phase-badge">
                        <span>3</span> Rate controls
                    </div>
                    <div class="phase-badge">
                        <span>4</span> Plan remediation
                    </div>
                </div>
                <div class="print-note">
                    <strong>Tip:</strong> Use this snapshot as your quick ‚Äúexecutive summary‚Äù when discussing results with agency leadership.
                </div>
            </div>

            <div class="side-section">
                <div class="side-section-header">
                    <div class="side-section-title">CJIS Environment Summary</div>
                    <div class="side-section-sub">Optional ‚Äì for context</div>
                </div>
                <div class="inline-grid">
                    <div class="field-group">
                        <div class="field-label"><span>Approximate CJIS Users</span></div>
                        <input type="text" id="approxUsers" class="micro-input" placeholder="e.g., 45">
                    </div>
                    <div class="field-group">
                        <div class="field-label"><span>CJIS Systems in Use</span></div>
                        <textarea id="cjisSystems" placeholder="CAD, RMS, NCIC/TCIC terminals, JMS, Livescan, in-car MDTs, etc."></textarea>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-label"><span>High-Level Environment Notes</span></div>
                    <textarea id="environmentNotes"
                              placeholder="Network segmentation, hosted vendors, shared systems (county, city IT), physical layout, etc."></textarea>
                </div>
            </div>

            <div class="side-section">
                <div class="side-section-header">
                    <div class="side-section-title">Key Risks & Immediate Actions</div>
                    <div class="side-section-sub">For quick triage</div>
                </div>
                <div class="field-group">
                    <div class="field-label"><span>Immediate Risk Items (0‚Äì90 days)</span></div>
                    <textarea id="riskImmediate" placeholder="Summarize the most critical gaps that should be addressed first."></textarea>
                </div>
                <div class="field-group">
                    <div class="field-label"><span>Short-Term Projects (3‚Äì12 months)</span></div>
                    <textarea id="riskShortTerm" placeholder="e.g., MFA expansion, log centralization, policy updates, training backlog."></textarea>
                </div>
                <div class="field-group">
                    <div class="field-label"><span>Longer-Term Improvements</span></div>
                    <textarea id="riskLongTerm"
                              placeholder="e.g., infrastructure modernization, new CJIS-compliant hosted systems, staffing changes."></textarea>
                </div>
            </div>

            <div class="side-section">
                <div class="side-section-header">
                    <div class="side-section-title">Assessor Notes</div>
                    <div class="side-section-sub">For your internal use</div>
                </div>
                <textarea id="assessorNotes" placeholder="Use this space for meta-notes about the assessment process or follow-up steps."></textarea>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <div class="toast-icon">‚úì</div>
    <div class="toast-text" id="toastText">Saved</div>
</div>

<div class="modal-backdrop" id="controlModalBackdrop">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title" id="controlModalTitle">Control Evidence</div>
            <button class="modal-close" onclick="closeControlModal()">‚úï</button>
        </div>
        <div class="modal-body" id="controlModalBody"></div>
    </div>
</div>

<script>
    const cjisControls = {
        policyAreas: [
            {
                id: "pa1",
                name: "Policy Area 1 ‚Äì Information Exchange Agreements",
                code: "5.1",
                description: "Agreements and documentation governing the exchange of CJI, including MOUs, MOAs, and sharing with other agencies or vendors.",
                importance: "high",
                requirements: [
                    {
                        id: "pa1-r1",
                        title: "Written Information Exchange Agreements",
                        summary: "Documented agreements (e.g., MOUs/MOAs) are in place for all external entities receiving or providing CJI.",
                        evidence: [
                            "MOUs/MOAs with partner agencies",
                            "Information sharing agreements with county, state, or regional systems",
                            "Contracts or documents referencing CJI handling responsibilities"
                        ],
                        notesPlaceholder: "List key exchange partners and where agreements are stored."
                    },
                    {
                        id: "pa1-r2",
                        title: "Scope & Security Responsibilities Defined",
                        summary: "Agreements clearly describe what CJI is exchanged, how it is protected, and which party is responsible for which controls.",
                        evidence: [
                            "Sections in MOUs/MOAs that specify CJI scope",
                            "Security responsibility matrices or addenda",
                            "CSA guidance cross-referenced in agreements"
                        ],
                        notesPlaceholder: "Note any agreements where responsibilities are unclear or outdated."
                    },
                    {
                        id: "pa1-r3",
                        title: "Review & Update of Exchange Agreements",
                        summary: "Agreements are reviewed periodically (e.g., every 3‚Äì5 years or when systems/partners change) and updated as needed.",
                        evidence: [
                            "Review schedule for agreements",
                            "Tracked revision dates on MOUs/MOAs",
                            "Emails or documentation of recent updates"
                        ],
                        notesPlaceholder: "Describe how the agency tracks agreement currency and who is responsible."
                    },
					{
						id: "pa1-r4",
						title: "Service Provider Monitoring & Oversight",
						summary: "Services provided under information exchange, MCAs, and contracts are regularly monitored and reviewed. The agency maintains overall control and visibility into security aspects, including how vulnerabilities and security incidents are identified, reported, and handled.",
						evidence: [
							"Documented process or SOP for monitoring service providers",
							"Sample service provider performance or security reports",
							"Evidence that provider incident reporting aligns with CJIS incident reporting requirements"
						],
						notesPlaceholder: "Describe how the agency reviews provider services and maintains oversight of security controls."
					},
					{
						id: "pa1-r5",
						title: "Change Management for Service Providers",
						summary: "Changes to services provided by service providers (new services, modifications, or discontinuations) are formally managed by the agency, including risk evaluation based on data/system criticality and potential impact.",
						evidence: [
							"Change management policy or procedure covering service providers",
							"Recent change requests or approvals showing risk evaluation",
							"Meeting notes or ticket records documenting review of provider changes"
						],
						notesPlaceholder: "Note how provider changes are initiated, reviewed, and approved, and who is responsible."
					}
                ]
            },
            {
                id: "pa2",
                name: "Policy Area 2 ‚Äì Security Awareness Training",
                code: "5.2",
                description: "Training for all personnel with access to CJI or CJIS systems, including contractors and vendors, at initial onboarding and periodic intervals.",
                importance: "critical",
                requirements: [
                    {
                        id: "pa2-r1",
                        title: "Initial CJIS Security Awareness Training",
                        summary: "All personnel with CJI access receive security awareness training before being granted access, per CSA schedule.",
                        evidence: [
                            "Training rosters or LMS completion reports",
                            "Onboarding checklists linking training to access",
                            "Training curriculum or slides covering CJIS topics"
                        ],
                        notesPlaceholder: "Note how the agency ensures no access is granted before training completion."
                    },
                    {
                        id: "pa2-r2",
                        title: "Recurring / Refresher Training",
                        summary: "Recurring training is delivered as required by CSA (e.g., every 2 years) and completion is tracked.",
                        evidence: [
                            "Calendar or schedule for recurring training",
                            "Records showing completion rates and overdue users",
                            "Automated reminders or tracking system"
                        ],
                        notesPlaceholder: "Describe how overdue users are identified and addressed."
                    },
                    {
                        id: "pa2-r3",
                        title: "Role-Based Training for TAC/LASO/IT",
                        summary: "Enhanced training for TAC, LASO, IT, and privileged roles covering governance, logging, and incident response.",
                        evidence: [
                            "Certificates or notes from role-specific training",
                            "Agenda from TAC/LASO workshops or CSA sessions",
                            "Local training materials for IT staff on CJIS topics"
                        ],
                        notesPlaceholder: "Summarize current role-based training and any gaps."
                    },
					{
						id: "pa2-r4",
						title: "Security Awareness Policy & Procedures",
						summary: "A written security awareness and training policy and supporting procedures exist, assign responsibility for managing the program, and are reviewed at least annually or when significant changes or incidents occur.",
						evidence: [
							"Documented security awareness and training policy",
							"Procedure document describing how training is planned, delivered, and tracked",
							"Designation of responsible personnel (e.g., TAC, LASO, training coordinator)",
							"Version history or review log showing annual review/updates"
						],
						notesPlaceholder: "Describe where the policy/procedures are stored, who owns them, and how reviews and updates are documented."
					}
                ]
            },
            {
				id: "pa3",
				name: "Policy Area 3 ‚Äì Incident Response",
				code: "5.3",
				description: "Processes for detecting, responding to, reporting, and learning from incidents involving CJIS systems or CJI.",
				importance: "high",
				requirements: [
					{
						id: "pa3-r1",
						title: "Incident Response Policy & Procedures (IR-1)",
						summary: "A written incident response policy and detailed procedures exist, define roles and responsibilities (including TAC/LASO and IT), and are reviewed annually or following major changes or incidents.",
						evidence: [
							"Incident Response Policy",
							"IR procedures or playbooks covering identification, containment, eradication, and recovery",
							"Version history or annual policy review log",
							"Designation of responsible personnel (IR lead, TAC, LASO, IT)"
						],
						notesPlaceholder: "Identify where IR policy/procedures are stored, who owns them, and how they are maintained."
					},
					{
						id: "pa3-r2",
						title: "Written Incident Response Plan (IR-8)",
						summary: "A formal Incident Response Plan exists, references CJIS-specific requirements, and is approved by appropriate leadership.",
						evidence: [
							"IRP document with approval signatures",
							"Plan sections referencing CJIS reporting requirements",
							"Distribution list or acknowledgement of receipt"
						],
						notesPlaceholder: "Note whether the IRP integrates with broader city/county incident response plans."
					},
					{
						id: "pa3-r3",
						title: "Incident Handling & Monitoring (IR-4 / IR-5)",
						summary: "Documented procedures exist for identifying, analyzing, containing, and recovering from CJIS-related incidents, including monitoring tools and responsibilities.",
						evidence: [
							"Incident handling workflow or runbooks",
							"SIEM/SOC alert procedures or system monitoring outputs",
							"Detection/response flowcharts or escalation diagrams",
							"Incident ticketing/record examples (redacted)"
						],
						notesPlaceholder: "Describe how incidents are detected, escalated, and managed."
					},
					{
						id: "pa3-r4",
						title: "Incident Response Training (IR-2)",
						summary: "Personnel with IR responsibilities (IT, TAC, LASO, supervisors, and system admins) receive role-based IR training initially and annually.",
						evidence: [
							"Training rosters for IR personnel",
							"Certificates or LMS reports for IR-specific courses",
							"Agenda/materials from IR workshops or tabletop briefings"
						],
						notesPlaceholder: "Summarize the IR training cadence and any known gaps."
					},
					{
						id: "pa3-r5",
						title: "Incident Reporting to CSA / State (IR-6)",
						summary: "Procedures exist for reporting CJIS-related incidents to the CSA or state CJIS authority within required timeframes.",
						evidence: [
							"CSA/CJIS reporting procedures integrated into IRP",
							"Contact lists for state CJIS and cyber response teams",
							"Recent incident reporting examples (if applicable, anonymized)"
						],
						notesPlaceholder: "Assess how staff know when/how to notify CSA or state authorities."
					},
					{
						id: "pa3-r6",
						title: "Incident Response Assistance & Escalation (IR-7)",
						summary: "The agency has defined assistance resources (CSA, fusion center, state cyber team, vendor support) and escalation paths for severe incidents.",
						evidence: [
							"Escalation diagrams showing internal and external contacts",
							"MOUs/MOAs with assistance partners",
							"Incident management vendor contracts or support agreements"
						],
						notesPlaceholder: "List available assistance resources and expected response timelines."
					},
					{
						id: "pa3-r7",
						title: "Exercises & Lessons Learned (IR-3)",
						summary: "Tabletop exercises or incident simulations are conducted periodically, with documented lessons learned and updated procedures or policies.",
						evidence: [
							"Exercise agendas, injects, and sign-in sheets",
							"After-action reports and remediation plans",
							"Updates to IRP or policies based on lessons learned"
						],
						notesPlaceholder: "Identify recent exercises and key improvements that resulted."
					}
				]
			},
						{
				id: "pa4",
				name: "Policy Area 4 ‚Äì Auditing and Accountability",
				code: "5.4",
				description: "Audit logs and monitoring for CJIS systems, including capture of key security events and regular review.",
				importance: "critical",
				requirements: [
					{
						id: "pa4-r1",
						title: "Audit Logging Enabled for CJIS Systems",
						summary: "CJIS systems (CAD, RMS, NCIC/TCIC terminals, etc.) generate audit logs for logon, query, administrative, and security events.",
						evidence: [
							"Screenshots of logging settings",
							"Sample audit logs showing required events",
							"Vendor documentation or config exports"
						],
						notesPlaceholder: "List key systems with logging enabled and any known gaps."
					},
					{
						id: "pa4-r2",
						title: "Log Retention & Protection",
						summary: "Logs are retained for an appropriate period and protected from unauthorized modification or deletion.",
						evidence: [
							"Retention settings or schedules",
							"Evidence of log backup or archiving",
							"Controls limiting admin access to logs"
						],
						notesPlaceholder: "Note any systems where logs are overwritten too quickly or not centralized."
					},
					{
						id: "pa4-r3",
						title: "Log Review & Use in Investigations",
						summary: "Logs are reviewed for anomalies and used during investigations into potential misuse or security events.",
						evidence: [
							"Documented log review procedures",
							"Examples of log-based investigations (redacted)",
							"SIEM dashboards or reports (if used)"
						],
						notesPlaceholder: "Describe who reviews logs, how often, and how findings are escalated."
					},
					{
						id: "pa4-r4",
						title: "Audit & Accountability Policy and Procedures (AU-1)",
						summary: "A written audit and accountability policy and supporting procedures exist, assign roles and responsibilities, define minimum logging requirements, and are reviewed at least annually or following major changes/incidents.",
						evidence: [
							"Formal audit and accountability policy document",
							"Procedures for log collection, storage, review, and escalation",
							"Version history or annual review log for the policy",
							"Designation of responsible personnel (e.g., TAC, IT, ISO)"
						],
						notesPlaceholder: "Describe where the policy/procedures are stored, who owns them, and how updates are tracked."
					},
					{
						id: "pa4-r5",
						title: "Audit Log Failure Detection & Alerting (AU-5)",
						summary: "Systems detect and alert on audit logging failures, log service interruptions, or insufficient log storage capacity, and such alerts are monitored and acted upon.",
						evidence: [
							"SIEM or system alert rules for logging failures and log storage thresholds",
							"Screenshots of alert configuration and notification settings",
							"Examples of past alerts and follow-up actions (redacted)"
						],
						notesPlaceholder: "Explain how the agency becomes aware of logging failures or storage issues and who responds."
					},
					{
						id: "pa4-r6",
						title: "Time Synchronization for Logged Systems (AU-8)",
						summary: "All CJIS-related systems use a common, authoritative time source (e.g., NTP) so that audit records across systems have consistent timestamps.",
						evidence: [
							"NTP configuration on domain controllers and key CJIS systems",
							"Network diagram or documentation showing time source hierarchy",
							"Sample logs demonstrating consistent timestamps across systems"
						],
						notesPlaceholder: "Note any systems not yet synchronized to the authoritative time source."
					},
					{
						id: "pa4-r7",
						title: "Audit Log Integrity & Non-Repudiation (AU-10)",
						summary: "Audit logs are protected to ensure authenticity, integrity, and attribution to individual users, using technical and procedural controls such as access restrictions, hashing, or WORM/immutable storage.",
						evidence: [
							"Configuration of WORM/immutable storage or log integrity features",
							"Access control lists limiting who can view/modify logs",
							"Documentation describing how log integrity is validated"
						],
						notesPlaceholder: "Describe how the agency ensures logs cannot be altered without detection and how user actions are attributable."
					},
					{
						id: "pa4-r8",
						title: "Centralized / Correlated Log Analysis (AU-16)",
						summary: "Audit logs from multiple CJIS systems (e.g., CAD, RMS, MDTs, domain controllers, firewalls) are centralized or otherwise correlated to support security monitoring and investigations.",
						evidence: [
							"List of systems sending logs to a central SIEM or log server",
							"SIEM or log management configuration showing data sources",
							"Examples of investigations or reports using correlated logs (redacted)"
						],
						notesPlaceholder: "Identify any key systems whose logs are not yet centralized or included in correlation."
					}
				]
			},
						{
				id: "pa5",
				name: "Policy Area 5 ‚Äì Access Control",
				code: "5.5‚Äì5.7",
				description: "Provisioning, authentication, and removal of access to CJIS systems and CJI, including account lifecycle, session controls, and access-related configuration management.",
				importance: "critical",
				requirements: [
					{
						id: "pa5-r1",
						title: "User Access Authorization & Onboarding",
						summary: "Formal process for authorizing CJIS access, including verification of need-to-know and completion of background checks and training.",
						evidence: [
							"User access request forms or tickets",
							"Onboarding checklists linking CJIS prerequisites",
							"Approval workflow or signatures for new users"
						],
						notesPlaceholder: "Describe how TAC/LASO and HR coordinate on new CJIS users."
					},
					{
						id: "pa5-r2",
						title: "Account Review & Deprovisioning",
						summary: "Regular review of CJIS accounts and prompt removal or adjustment when personnel separate or change roles.",
						evidence: [
							"Periodic access review reports",
							"Offboarding checklists including CJIS access",
							"Evidence of disabled/removed accounts after separation"
						],
						notesPlaceholder: "Note how quickly access is typically removed after separation."
					},
					{
						id: "pa5-r3",
						title: "Privileged & Shared Account Controls",
						summary: "Use of individual IDs for accountability, with limited use of shared or generic accounts and strong controls around privileged access.",
						evidence: [
							"Policies restricting shared logins",
							"List of privileged accounts and groups",
							"Procedures for privileged access reviews"
						],
						notesPlaceholder: "Identify any legacy shared accounts and steps toward remediation."
					},
					{
						id: "pa5-r4",
						title: "Authentication & Session Controls (5.6 ‚Äì Identification & Authentication)",
						summary: "Authentication mechanisms for CJIS systems enforce unique user credentials, strong authenticator requirements (e.g., password complexity and rotation, MFA where required by CSA), account lockout after failed attempts, and session timeout/lock for inactive devices including MDTs.",
						evidence: [
							"Password and authentication policy (including MFA requirements)",
							"GPO/MDM configuration showing password complexity, lockout thresholds, and maximum password age",
							"Screenshots or config exports showing session timeout and screen-lock settings on workstations and MDTs",
							"Documentation or tickets showing process for handling lost/compromised credentials"
						],
						notesPlaceholder: "Describe how authentication standards are enforced across CJIS-connected systems (domain-joined workstations, MDTs, hosted/remote systems)."
					},
					{
						id: "pa5-r5",
						title: "Access-Related Configuration & Change Management (5.7 ‚Äì Configuration Management)",
						summary: "Changes to access control configurations (roles, groups, ACLs, firewall rules affecting CJIS access, VPN profiles, etc.) follow a documented change management process that includes request, approval, testing/validation, and logging.",
						evidence: [
							"Configuration management or change control policy/procedure",
							"Sample change tickets showing access-related changes (role updates, group membership, VPN/firewall rule changes)",
							"Change advisory board (CAB) or review meeting notes (if applicable)",
							"Documentation showing baseline configurations for CJIS-related access controls"
						],
						notesPlaceholder: "Explain how access-related configuration changes are requested, approved, documented, and verified, and how emergency changes are handled."
					}
				]
			},
						{
				id: "pa6",
				name: "Policy Area 6 ‚Äì Identification and Authentication",
				code: "5.6",
				description: "How users and systems are uniquely identified and authenticated before accessing CJIS systems or CJI, including passwords, multi-factor authentication, and credential lifecycle management.",
				importance: "high",
				requirements: [
					{
						id: "pa6-r1",
						title: "Unique User Identification",
						summary: "Each individual with access to CJIS systems or CJI has a unique user ID; shared or generic logins are avoided or tightly controlled and mapped to specific individuals.",
						evidence: [
							"User account lists from Active Directory or application user management",
							"Policy or SOP requiring unique user IDs and prohibiting shared accounts",
							"Samples of audit logs showing activity tied to individual IDs"
						],
						notesPlaceholder: "Identify any remaining shared or generic accounts and how they are being phased out or compensated for."
					},
					{
						id: "pa6-r2",
						title: "Authentication Strength & Multi-Factor Authentication",
						summary: "Authentication mechanisms enforce strong credentials (e.g., password complexity and rotation) and MFA is implemented where required by CSA policy (e.g., remote access, VPN, administrative access, hosted CJIS systems).",
						evidence: [
							"Password and authentication policy (complexity, minimum length, reuse limits, maximum age)",
							"GPO/MDM configs showing password settings and MFA enforcement",
							"VPN / remote access configuration showing MFA requirements",
							"Vendor documentation or contracts describing MFA for hosted systems"
						],
						notesPlaceholder: "Describe where MFA is enabled today (VPN, RMS, CAD, mobile access) and any known gaps versus CSA requirements."
					},
					{
						id: "pa6-r3",
						title: "Account Lockout, Session Lock, and Inactivity Controls",
						summary: "Systems enforce account lockout after a defined number of failed logon attempts and configure session lock / automatic logoff for inactive workstations and mobile devices used to access CJI.",
						evidence: [
							"GPO/MDM settings showing lockout thresholds and durations",
							"Screenshots or exports of inactivity timeout and screen-lock settings on workstations and MDTs",
							"Local policy or SOP describing required lock/timeout values"
						],
						notesPlaceholder: "Note any systems or device types where lockout or session timeout is not yet configured or consistently enforced."
					},
					{
						id: "pa6-r4",
						title: "Credential Lifecycle & Reset Procedures",
						summary: "There are documented procedures for issuing, resetting, and revoking credentials (passwords, tokens, certificates, smart cards), including verification of user identity and prompt revocation when credentials are compromised or no longer needed.",
						evidence: [
							"Account/credential issuance and reset procedures",
							"Help desk or ticketing workflows showing identity verification steps",
							"Examples of credential revocation after separation or compromise (redacted)",
							"Certificate or token management documentation, if used"
						],
						notesPlaceholder: "Explain how the agency verifies identity before resets, handles lost or compromised credentials, and ensures credentials are revoked at separation."
					},
					{
						id: "pa6-r5",
						title: "Service, System, and Device Identities",
						summary: "Non-human accounts (service accounts, system accounts, device IDs) used for CJIS-related services are uniquely identified, documented, granted only necessary privileges, and managed under defined procedures.",
						evidence: [
							"Inventory of service and system accounts linked to owning system or application",
							"Configuration or documentation showing least-privilege access for service accounts",
							"Change tickets or procedures covering creation and modification of service accounts"
						],
						notesPlaceholder: "List key service/system accounts, what they are used for, and how their credentials are managed and monitored."
					}
				]
			},
						{
				id: "pa7",
				name: "Policy Area 7 ‚Äì Configuration Management",
				code: "5.7",
				description: "Baseline configurations, secure hardening standards, and formal change management for CJIS systems, networks, and security devices.",
				importance: "high",
				requirements: [
					{
						id: "pa7-r1",
						title: "Baseline Secure Configurations",
						summary: "Baseline configurations (build standards) are defined and documented for CJIS-related systems (servers, workstations, MDTs, network devices, security appliances) and used as the reference for deployment and auditing.",
						evidence: [
							"Documented baseline build checklists or hardening guides",
							"Golden image documentation for CJIS workstations/MDTs",
							"Configuration templates for firewalls, switches, and wireless controllers",
							"Evidence of baselines referenced in deployment procedures"
						],
						notesPlaceholder: "Describe which systems have formal baselines and how those baselines are maintained and distributed."
					},
					{
						id: "pa7-r2",
						title: "Configuration Change Management Process",
						summary: "Changes to configurations for CJIS systems (including firewall rules, VPN profiles, server builds, and security settings) follow a documented change management process that includes request, risk assessment, approval, implementation, and back-out/rollback plans.",
						evidence: [
							"Change management policy or SOP",
							"Sample change tickets showing approvals and risk assessment",
							"Change Advisory Board (CAB) meeting notes or reviewer comments",
							"Rollback plans documented in change records"
						],
						notesPlaceholder: "Explain how normal, emergency, and standard changes are handled, and who must approve changes affecting CJIS systems."
					},
					{
						id: "pa7-r3",
						title: "Secure Configuration Standards & Hardening",
						summary: "Secure configuration standards (e.g., CIS, vendor guidance, CSA recommendations) are applied to CJIS systems and regularly reviewed for alignment with current threats and CJIS requirements.",
						evidence: [
							"Hardening checklists or references to CIS / vendor security baselines",
							"Policies requiring secure configuration of CJIS-connected systems",
							"Recent review or update of secure configuration standards",
							"Sample config snippets demonstrating hardened settings"
						],
						notesPlaceholder: "Identify which benchmarks or guidelines are used (CIS, vendor best practices, CSA guidance) and any known exceptions."
					},
					{
						id: "pa7-r4",
						title: "Configuration Monitoring & Integrity",
						summary: "Tools and/or procedures are in place to detect unauthorized or unapproved changes to configurations (e.g., configuration management tools, file integrity monitoring, periodic configuration reviews).",
						evidence: [
							"Configuration management or monitoring tool screenshots/reports",
							"File integrity monitoring (FIM) or SIEM alerts for config changes",
							"Periodic configuration review checklists or logs",
							"Procedures describing how unauthorized changes are investigated"
						],
						notesPlaceholder: "Describe how the agency becomes aware of configuration drift or unauthorized changes and how these are handled."
					},
					{
						id: "pa7-r5",
						title: "Configuration Documentation & CJIS Scope Tracking",
						summary: "Current network and system diagrams, asset inventories, and configuration documentation exist for CJIS in-scope systems and are updated when significant changes occur.",
						evidence: [
							"Network diagrams highlighting CJIS segments, firewalls, and VPNs",
							"Asset inventory for CJIS servers, workstations, MDTs, and network devices",
							"Documentation repository or CMDB records for CJIS-related assets",
							"Evidence of documentation updates following major changes or projects"
						],
						notesPlaceholder: "Note where diagrams and inventories are stored, who maintains them, and how quickly they are updated after changes."
					}
				]
			},
						{
				id: "pa8",
				name: "Policy Area 8 ‚Äì Media Protection",
				code: "5.8",
				description: "Protection of digital and physical media containing CJI, including inventory, storage, transport, encryption, sanitization, and disposal.",
				importance: "high",
				requirements: [
					{
						id: "pa8-r1",
						title: "Media Inventory & Classification",
						summary: "Media containing CJI (backup tapes, external drives, USB media, DVDs, printed reports, export files, etc.) is identified, inventoried where appropriate, and handled according to its sensitivity.",
						evidence: [
							"Media handling or classification policy/SOP",
							"Inventory or tracking logs for backup media and removable drives",
							"Labels or markings indicating CJI/sensitivity on media or containers",
							"Procedures describing how CJI exports (reports, files) are tracked"
						],
						notesPlaceholder: "Describe what types of media contain CJI, how they are identified, and how the agency keeps track of them."
					},
					{
						id: "pa8-r2",
						title: "Secure Storage & Access to CJI Media",
						summary: "Physical and electronic media containing CJI are stored securely (e.g., locked rooms/cabinets, secure server rooms, restricted shares) with access limited to authorized personnel on a need-to-know basis.",
						evidence: [
							"Policy or SOP describing storage requirements for CJI media",
							"Photos or diagrams of secure storage locations (e.g., locked cabinets, evidence rooms, server rooms)",
							"Access control lists (ACLs) for file shares or storage systems holding CJI",
							"Key / badge access records for areas where CJI media is stored"
						],
						notesPlaceholder: "Explain where CJI media is stored (on-site and off-site) and how access is restricted and monitored."
					},
					{
						id: "pa8-r3",
						title: "Media Transport & Offsite Handling",
						summary: "Procedures exist for safely transporting CJI media (including backups, evidence discs, exported reports, and mobile storage) on- and off-site, including physical protection, accountability, and approved couriers or methods.",
						evidence: [
							"Media transport / chain-of-custody procedures",
							"Completed chain-of-custody forms or logs for transported media (redacted)",
							"Vendor or courier contracts that address protection of CJI media",
							"Documentation showing controls for offsite backup storage (e.g., vault services)"
						],
						notesPlaceholder: "Describe how CJI media is protected when moved between locations, including labeling, custody tracking, and approved transport methods."
					},
					{
						id: "pa8-r4",
						title: "Media Sanitization & Disposal",
						summary: "CJI media is sanitized or destroyed using approved methods before reuse or disposal (e.g., wiping, degaussing, shredding, physical destruction) in accordance with CJIS and agency policy, with records retained as appropriate.",
						evidence: [
							"Media sanitization and destruction policy/SOP",
							"Certificates or logs of destruction from internal processes or third-party vendors",
							"Procedures for sanitizing devices before reassignment or surplus",
							"Documentation of approved sanitization tools or methods"
						],
						notesPlaceholder: "Explain how the agency ensures CJI is not recoverable from discarded or repurposed media and how this is documented."
					},
					{
						id: "pa8-r5",
						title: "Electronic Storage Protections (Backups, Cloud, and Portable Devices)",
						summary: "Electronic media containing CJI (on-prem storage, backups, cloud/SaaS storage, laptops, MDTs, body-camera repositories, etc.) is protected with appropriate technical controls such as encryption, access controls, and segregation from non-CJIS data.",
						evidence: [
							"Architecture diagrams showing where CJI is electronically stored (on-prem, cloud, hosted vendors)",
							"Configuration / documentation showing encryption at rest for backup systems, storage arrays, and cloud repositories",
							"Vendor contracts or CJIS addenda for hosted storage of CJI (e.g., RMS/CAD/body-cam platforms)",
							"Policies or configs for full-disk encryption on laptops, MDTs, and other portable devices that store CJI"
						],
						notesPlaceholder: "List the main electronic storage locations for CJI and describe how each is protected (encryption, access controls, segmentation, vendor agreements)."
					}
				]
			},
						{
				id: "pa9",
				name: "Policy Area 9 ‚Äì Physical Protection",
				code: "5.9",
				description: "Physical safeguards for facilities, equipment, workstations, and environments where CJI is accessed, processed, or stored, including visitor control, access restriction, monitoring, and protection of CJIS terminals and MDTs.",
				importance: "high",
				requirements: [
					{
						id: "pa9-r1",
						title: "Secure Facilities & Controlled Areas",
						summary: "Facilities housing CJIS systems or CJI (dispatch, records, server rooms, evidence rooms, NCIC terminals) are designated as secure areas with physical access controls such as badge systems, keys, logs, or staffed access points.",
						evidence: [
							"Access control policy or SOP for secure areas",
							"Floorplans or diagrams identifying CJIS secure spaces",
							"Badge or key access logs for restricted rooms",
							"Photos showing physical controls (e.g., card readers, locked cabinets)"
						],
						notesPlaceholder: "Describe how secure areas are defined and protected, including any multi-tenant/shared spaces with city or county IT."
					},
					{
						id: "pa9-r2",
						title: "Visitor Management & Escort Requirements",
						summary: "Visitors to CJIS-controlled areas are identified, logged, and escorted at all times; visitor badges or temporary credentials are issued and collected at exit.",
						evidence: [
							"Visitor log templates or completed logs (redacted)",
							"Visitor badge procedures",
							"Policy requiring escort of non-cleared individuals",
							"Camera footage or vestibule controls (if applicable)"
						],
						notesPlaceholder: "Explain how visitors are handled in dispatch, records, server rooms, and evidence areas, including after-hours procedures."
					},
					{
						id: "pa9-r3",
						title: "Workstation & Terminal Physical Protections",
						summary: "CJIS-connected workstations, mobile data terminals (MDTs), kiosks, and NCIC/TCIC terminals are positioned and protected to prevent unauthorized viewing or physical access to CJI.",
						evidence: [
							"Photos of workstation/terminal placement within secure areas",
							"Privacy screens, locked docking stations, or secured mounting brackets",
							"Procedures requiring terminals to be logged off when unattended",
							"Documentation of MDT physical security in vehicles"
						],
						notesPlaceholder: "Document how NCIC/TCIC terminals and MDTs are protected from shoulder surfing, public access, and unauthorized physical manipulation."
					},
					{
						id: "pa9-r4",
						title: "Environmental & Physical Monitoring",
						summary: "Secure areas and server/network rooms supporting CJIS systems use appropriate physical monitoring such as cameras, intrusion detection, alarms, or staffed control points.",
						evidence: [
							"Security camera coverage maps or retention policy",
							"Alarm system configuration or contracts",
							"Access control system logs (badge, keycard, PIN entries)",
							"Monitoring SOPs or integration with dispatch/SOC"
						],
						notesPlaceholder: "Describe how monitoring alerts are handled and who responds when a door alarm, forced entry, or unexpected access occurs."
					},
					{
						id: "pa9-r5",
						title: "Protection of Portable Devices & Mobile Assets",
						summary: "Laptops, tablets, MDTs, body-worn camera docks, and other portable devices that access or store CJI are physically protected, secured when unattended, and controlled during transport.",
						evidence: [
							"MDT mounting and lock hardware documentation",
							"Policies requiring secure storage in patrol vehicles or offices",
							"Evidence of asset tagging and portable device tracking",
							"Procedures for reporting lost/stolen mobile devices"
						],
						notesPlaceholder: "Describe how officers and staff secure MDTs, laptops, and other mobile devices during shifts, transport, and off-duty periods."
					},
					{
						id: "pa9-r6",
						title: "Facility Maintenance, Cleaning, and Vendor Access",
						summary: "Maintenance personnel, janitorial staff, or third-party vendors with access to CJIS-controlled spaces are screened, escorted, or restricted to ensure they cannot view or access CJI.",
						evidence: [
							"Vendor access policies or contracts",
							"Logs showing escorted vendor visits",
							"Written procedures for janitorial/maintenance after-hours access",
							"Screenshots/photos showing terminals secured prior to cleaning"
						],
						notesPlaceholder: "Note which vendor roles require supervision and how the agency ensures terminals and documents are secured when cleaners or contractors are present."
					}
				]
			},
						{
				id: "pa10",
				name: "Policy Area 10 ‚Äì System and Communications Protection",
				code: "5.10",
				description: "Network, host, and communications protections for CJIS systems, including segmentation, boundary defenses, encryption in transit, remote access controls, and wireless security.",
				importance: "critical",
				requirements: [
					{
						id: "pa10-r1",
						title: "Network Segmentation for CJIS Systems",
						summary: "CJIS systems and CJI traffic are logically and/or physically segmented from non-CJIS networks using VLANs, firewalls, and access control lists to limit exposure and lateral movement.",
						evidence: [
							"Network diagrams showing CJIS segments, VLANs, and routing boundaries",
							"Firewall or router ACL configurations separating CJIS and non-CJIS networks",
							"Documentation of network zones (e.g., dispatch, records, admin, guest)"
						],
						notesPlaceholder: "Describe how CJIS network segments are separated from general city/county or guest networks and how exceptions are handled."
					},
					{
						id: "pa10-r2",
						title: "Boundary Protection & Firewalls",
						summary: "Firewalls and other boundary devices (e.g., NGFW, UTM, secure gateways) are deployed at network perimeters and key internal boundaries, with rulesets that restrict traffic to approved CJIS-related services.",
						evidence: [
							"Firewall rule summaries or exports (sanitized)",
							"Diagrams showing perimeter and internal firewalls protecting CJIS systems",
							"Change management records for firewall rule updates"
						],
						notesPlaceholder: "Explain where firewalls or other boundary controls are placed and how rules are reviewed for least privilege."
					},
					{
						id: "pa10-r3",
						title: "Encryption of CJI in Transit",
						summary: "CJI transmitted over any shared or untrusted network (including the Internet, municipal WANs, wireless, and vendor connections) is protected using strong, current encryption protocols (e.g., TLS, IPsec VPN) consistent with CJIS requirements.",
						evidence: [
							"VPN configuration showing encryption protocols and key lengths",
							"RMS/CAD/hosted vendor documentation confirming TLS or equivalent encryption for CJI connections",
							"Network captures or test results verifying encrypted sessions"
						],
						notesPlaceholder: "List major paths where CJI traverses shared networks (RMS, CAD, MDT VPN, vendor-hosted systems) and describe how encryption is enforced on each."
					},
					{
						id: "pa10-r4",
						title: "Remote Access & Vendor Connectivity Controls",
						summary: "Remote access to CJIS systems (including VPN, remote desktop, vendor support tunnels, and cloud portals) is minimized, strictly controlled, and protected with MFA and session protections.",
						evidence: [
							"Remote access policy/SOP",
							"VPN and remote desktop configurations, including MFA enforcement",
							"Vendor remote access procedures and contracts (e.g., jump boxes, time-limited access)",
							"Logs or reports of remote sessions for CJIS systems"
						],
						notesPlaceholder: "Describe who can remotely access CJIS systems, by what methods, and how those sessions are authenticated, authorized, and monitored."
					},
					{
						id: "pa10-r5",
						title: "Wireless Network Protections",
						summary: "Wireless networks that carry or can reach CJI (including public safety Wi-Fi, in-building APs, and vehicle-based Wi-Fi) use strong encryption, authentication, and segmentation; guest or public Wi-Fi is isolated from CJIS systems.",
						evidence: [
							"Wireless network diagrams and SSID configurations",
							"WLAN controller settings showing WPA2/WPA3 enterprise, 802.1X, or equivalent",
							"Documentation showing separation of CJIS-related SSIDs from guest or public SSIDs",
							"Policies governing MDT and mobile device use on wireless networks"
						],
						notesPlaceholder: "Explain which wireless networks have any path to CJIS systems and how they are secured and segmented from public or guest access."
					},
					{
						id: "pa10-r6",
						title: "Host-Based Protections & Endpoint Security",
						summary: "CJIS-connected endpoints (servers, workstations, MDTs) implement host-based protections such as endpoint protection/EDR, host firewalls, and secure configuration settings aligned with CJIS and local policy.",
						evidence: [
							"Endpoint protection/EDR deployment reports or console screenshots",
							"Host firewall policies (e.g., GPO settings) applied to CJIS endpoints",
							"Secure configuration checklists for CJIS servers and workstations"
						],
						notesPlaceholder: "Describe which endpoint protections are deployed to CJIS-connected hosts and any known coverage gaps."
					},
					{
						id: "pa10-r7",
						title: "Protection of Interconnections & Third-Party Links",
						summary: "Connections between the agency and external entities (state CJIS networks, regional systems, shared county networks, cloud/hosted services) are documented, authorized, and protected with appropriate security controls and agreements.",
						evidence: [
							"Inventory of external network connections and data flows involving CJI",
							"Network or VPN diagrams showing interconnections to state and vendor systems",
							"MOUs, MSAs, or security addenda describing technical protections for those connections"
						],
						notesPlaceholder: "List major external connections that carry CJI and summarize the technical controls (encryption, filtering, monitoring) and agreements in place for each."
					}
				]
			},
						{
				id: "pa11",
				name: "Policy Area 11 ‚Äì Formal Audits",
				code: "5.11",
				description: "Formal CJIS-related audits and reviews conducted by the CSA, FBI, and the local agency, including preparation, evidence retention, findings tracking, and vendor oversight.",
				importance: "high",
				requirements: [
					{
						id: "pa11-r1",
						title: "Formal Audit Program & Schedule",
						summary: "The agency maintains awareness of CSA/FBI audit requirements and has a documented approach for formal audits and periodic self-assessments of CJIS compliance (e.g., triennial cycle, annual internal reviews).",
						evidence: [
							"Audit policy or SOP describing required CJIS audits and internal reviews",
							"Audit calendar or schedule showing planned CSA/FBI and self-audits",
							"Emails or memos from CSA regarding upcoming audit cycles"
						],
						notesPlaceholder: "Describe how the agency plans for CJIS audits (frequency, scope, responsible personnel) and any recurring internal self-audits."
					},
					{
						id: "pa11-r2",
						title: "Audit Preparation & Scope Documentation",
						summary: "Prior to formal audits, the agency prepares scope documentation (systems, locations, vendors, key contacts) and gathers required evidence such as policies, network diagrams, inventories, and training records.",
						evidence: [
							"Pre-audit checklists or preparation guides",
							"Prior audit packets or binders used for CSA/FBI audits",
							"Scope documents listing CJIS systems, facilities, and vendors",
							"Internal communications assigning audit preparation tasks"
						],
						notesPlaceholder: "Explain how the agency prepares for audits and where prior audit packets or preparation materials are stored."
					},
					{
						id: "pa11-r3",
						title: "Audit Records & Evidence Retention",
						summary: "Audit reports, findings letters, supporting evidence, and correspondence from CSA/FBI or other auditors are retained for the period required by CJIS and local records policies and are accessible to authorized personnel.",
						evidence: [
							"Copies of prior CSA/FBI audit reports and correspondence (redacted as needed)",
							"Records retention schedule covering audit materials",
							"Designated storage location (electronic or physical) for audit files"
						],
						notesPlaceholder: "Describe where audit records are stored, who has access, and how long they are retained."
					},
					{
						id: "pa11-r4",
						title: "Findings, Corrective Action Plans, and Tracking",
						summary: "Audit findings and recommendations are formally documented; corrective action plans (CAPs) are developed, approved, and tracked to completion, with status reported to leadership and, when required, to the CSA/FBI.",
						evidence: [
							"Corrective action plans or remediation tracking spreadsheets",
							"Status reports to leadership summarizing open and closed findings",
							"Documentation showing closure of past findings (e.g., updated policies, configs, training records)"
						],
						notesPlaceholder: "Summarize major past findings, current status of open items, and how CAPs are tracked and reported."
					},
					{
						id: "pa11-r5",
						title: "Audit Coverage for Vendors & Noncriminal Justice Partners",
						summary: "Vendors and noncriminal justice agencies with CJI access are included in the audit program through contracts, CJIS Security Addenda, or separate assessments to ensure their compliance with CJIS requirements.",
						evidence: [
							"Contracts or MOUs with CJIS Security Addenda for vendors and partners",
							"Vendor or partner CJIS audit/assessment reports, if available",
							"Internal reviews of vendor controls or questionnaires",
							"CSA guidance or documentation referencing vendor oversight"
						],
						notesPlaceholder: "List key CJIS-related vendors/partners and describe how their compliance is evaluated and documented."
					},
					{
						id: "pa11-r6",
						title: "Coordination with CSA/FBI and Follow-Up Reporting",
						summary: "The agency coordinates with the CSA/FBI before, during, and after audits, responds to requests for information, and provides required follow-up documentation demonstrating remediation of findings.",
						evidence: [
							"Email correspondence with CSA/FBI regarding audits and follow-up",
							"Submitted evidence packets or response letters for prior audits",
							"Internal procedure describing who communicates with CSA/FBI during audits"
						],
						notesPlaceholder: "Explain who serves as the primary point of contact with CSA/FBI for audits and how follow-up responses are managed."
					}
				]
			},
						{
				id: "pa12",
				name: "Policy Area 12 ‚Äì Personnel Security",
				code: "5.12",
				description: "Personnel screening, background checks, access approvals, separation procedures, and ongoing personnel security obligations for all individuals with access to CJI.",
				importance: "high",
				requirements: [
					{
						id: "pa12-r1",
						title: "Background Checks for Individuals with CJI Access",
						summary: "All personnel (employees, contractors, vendors, interns, volunteers) with access to CJI complete required state and federal background checks prior to receiving access, consistent with CJIS requirements and CSA policy.",
						evidence: [
							"Completed background check documentation (redacted)",
							"HR or TAC tracking logs showing background check dates",
							"Policy describing background check requirements for CJIS access"
						],
						notesPlaceholder: "Describe how the agency ensures each person completes required checks before access is granted."
					},
					{
						id: "pa12-r2",
						title: "Periodic Reinvestigations / Continuous Vetting",
						summary: "Personnel subject to CJIS requirements complete reinvestigations or updated background checks at the frequency required by the CSA (e.g., every 5 years), with tracking processes in place.",
						evidence: [
							"Reinvestigation schedule or tracking spreadsheet",
							"CSA guidance on reinvestigation intervals",
							"Records showing completed reinvestigations (redacted)"
						],
						notesPlaceholder: "Explain how reinvestigation cycles are monitored, who tracks them, and any current overdue cases."
					},
					{
						id: "pa12-r3",
						title: "Personnel Screening for Contractors & Third Parties",
						summary: "Contractors, vendors, and support personnel who have unescorted access to CJI or CJIS systems are screened to the same level as agency personnel, or alternative controls (escorting, restricted access) are used.",
						evidence: [
							"Contracts or agreements requiring CJIS-compliant personnel screening",
							"Background check records for vendor personnel (redacted)",
							"Procedures describing escort requirements for unscreened contractors"
						],
						notesPlaceholder: "List major vendors with CJI access and describe how personnel screening is verified."
					},
					{
						id: "pa12-r4",
						title: "Separation & Transfer Procedures",
						summary: "The agency follows formal offboarding procedures to remove system access, retrieve equipment, disable credentials, and update access lists immediately when personnel separate or change roles.",
						evidence: [
							"Offboarding checklists showing CJIS access removal steps",
							"Ticket history showing prompt deactivation of accounts",
							"Policies/SOPs for separations and role changes",
							"Logs indicating removal or disabling of physical and logical access"
						],
						notesPlaceholder: "Explain how the agency coordinates between HR, IT, and TAC during separations and role changes."
					},
					{
						id: "pa12-r5",
						title: "Noncriminal Justice Agency (NCJA) Personnel Requirements",
						summary: "When serving as a NCJA or working with NCJAs, the agency ensures compliance with all personnel security rules applying to noncriminal justice use of CJI, including screening, training, and access controls.",
						evidence: [
							"NCJA agreements or MOUs",
							"Training and screening documentation for NCJA personnel",
							"CSA guidance on NCJA personnel requirements"
						],
						notesPlaceholder: "Identify any NCJA relationships and summarize personnel security controls for those staff."
					},
					{
						id: "pa12-r6",
						title: "Personnel Security Awareness & Responsibilities",
						summary: "All personnel with access to CJI understand their obligations, including reporting suspicious behavior, maintaining confidentiality, following SOPs, and signing any required acknowledgments (e.g., CJIS Security Addendum responsibilities).",
						evidence: [
							"Policy/SOP requiring personnel to acknowledge responsibilities",
							"Signed CJIS Security Addendum (if required for roles)",
							"Training material covering personnel security expectations"
						],
						notesPlaceholder: "Describe how personnel are informed of their continuing security obligations and how acknowledgments are tracked."
					}
				]
			},
						{
				id: "pa13",
				name: "Policy Area 13 ‚Äì Mobile Devices",
				code: "5.13",
				description: "Controls for smartphones, tablets, laptops, MDTs, and other mobile devices that access or store CJI, including configuration, encryption, management, and loss/theft response.",
				importance: "critical",
				requirements: [
					{
						id: "pa13-r1",
						title: "Mobile Device Inventory & Scope",
						summary: "The agency maintains an inventory of mobile devices (MDTs, laptops, tablets, smartphones, body-worn camera docks, portable scanners) that access or store CJI, including ownership (agency vs. personally owned/BYOD) and assigned users or units.",
						evidence: [
							"Mobile device inventory or asset management reports",
							"Lists of MDTs and assigned vehicles or officers",
							"Documentation or policy identifying which device types may access CJI"
						],
						notesPlaceholder: "Describe which device types are allowed to access CJI and how those devices are tracked across the agency."
					},
					{
						id: "pa13-r2",
						title: "Mobile Device Configuration & Management",
						summary: "Mobile devices that access CJI are configured and managed using documented standards (e.g., MDM, GPO, baseline images) to enforce security settings such as password/PIN, auto-lock, OS updates, and application restrictions.",
						evidence: [
							"MDM or endpoint management console screenshots showing applied policies",
							"Configuration baselines for MDTs, laptops, and smartphones",
							"Policy or SOP describing required settings for CJIS-capable mobile devices"
						],
						notesPlaceholder: "Explain how configuration baselines are pushed to mobile devices and how compliance is monitored."
					},
					{
						id: "pa13-r3",
						title: "Encryption & Protection of CJI on Mobile Devices",
						summary: "Mobile devices that store or cache CJI use full-disk encryption and/or application-layer encryption consistent with CJIS requirements, and CJI is not stored unencrypted on removable media or unmanaged devices.",
						evidence: [
							"MDM or OS configuration screenshots showing full-disk encryption enabled",
							"Vendor documentation for encrypted CJIS apps used on mobile devices",
							"Policy prohibiting unencrypted storage of CJI on removable media or personal devices"
						],
						notesPlaceholder: "Identify which mobile platforms are used (Windows laptops, iOS/Android, MDT operating systems) and how encryption is enforced on each."
					},
					{
						id: "pa13-r4",
						title: "Remote Wipe, Lock, and Lost/Stolen Device Procedures",
						summary: "Procedures exist to promptly report, lock, and remotely wipe mobile devices that are lost, stolen, or otherwise compromised, and staff are trained on reporting requirements and timelines.",
						evidence: [
							"Incident response or mobile device loss/theft SOP",
							"MDM console capabilities for remote lock/wipe",
							"Examples of past lost/stolen device incidents and response (redacted)",
							"User guidance or training materials on how to report lost devices"
						],
						notesPlaceholder: "Describe how quickly the agency can detect and respond to lost or stolen mobile devices and who is responsible for remote actions."
					},
					{
						id: "pa13-r5",
						title: "Mobile Connectivity & Network Protections",
						summary: "Mobile devices accessing CJI over cellular or Wi-Fi use secure, approved connectivity methods (e.g., VPN with MFA, secure APs, carrier APNs) and do not use unsecured or public networks without appropriate encryption and controls.",
						evidence: [
							"VPN configuration and documentation for mobile/MDT access",
							"Carrier or APN documentation for law enforcement‚Äìspecific data service (if used)",
							"Policies prohibiting use of open/public Wi-Fi for CJI without VPN",
							"WLAN controller configs for in-building or vehicle Wi-Fi used by MDTs"
						],
						notesPlaceholder: "Explain how officers and staff connect mobile devices to agency resources (VPN, cellular, Wi-Fi) and how those paths are secured."
					},
					{
						id: "pa13-r6",
						title: "Personally Owned Devices (BYOD) and Restrictions",
						summary: "The agency has clear rules governing personally owned devices (BYOD) and only allows CJI access on such devices if they meet CJIS and agency security requirements (e.g., MDM enrollment, encryption, strong authentication); otherwise, CJI access is restricted to managed devices.",
						evidence: [
							"BYOD policy or explicit prohibition of CJI access from personal devices",
							"User acknowledgments or agreements for BYOD participants",
							"MDM enrollment records for any personally owned devices with CJI access",
							"Technical controls preventing CJI access from unmanaged or noncompliant devices"
						],
						notesPlaceholder: "Describe whether BYOD is permitted for any CJIS-related use, and if so, how those devices are controlled; if not, note how access from personal devices is blocked."
					}
				]
			}
        ]
    };

    const stateKey = "cjis_audit_v6_state";

    function buildStateObject() {
        const data = {
            org: {
                agencyName: document.getElementById("agencyName").value,
                ori: document.getElementById("ori").value,
                csa: document.getElementById("csa").value,
                assessmentDate: document.getElementById("assessmentDate").value,
                assessorName: document.getElementById("assessorName").value,
                assessorEmail: document.getElementById("assessorEmail").value,
                scopeNotes: document.getElementById("scopeNotes").value,
                assessmentType: document.getElementById("assessmentType").value
            },
            contacts: {
                tacName: document.getElementById("tacName").value,
                tacContact: document.getElementById("tacContact").value,
                lasoName: document.getElementById("lasoName").value,
                lasoContact: document.getElementById("lasoContact").value,
                itLead: document.getElementById("itLead").value,
                itContact: document.getElementById("itContact").value,
                tacLasoDocs: getRadioValue("tacLasoDocs"),
                localPolicy: getRadioValue("localPolicy")
            },
            environment: {
                approxUsers: document.getElementById("approxUsers").value,
                cjisSystems: document.getElementById("cjisSystems").value,
                environmentNotes: document.getElementById("environmentNotes").value
            },
            risk: {
                immediate: document.getElementById("riskImmediate").value,
                shortTerm: document.getElementById("riskShortTerm").value,
                longTerm: document.getElementById("riskLongTerm").value
            },
            assessor: {
                notes: document.getElementById("assessorNotes").value
            },
            controls: {},
            meta: {
                exportedAt: new Date().toISOString(),
                tool: "cjis-v6-local-agency-workbook",
                version: "0.1"
            }
        };

        cjisControls.policyAreas.forEach(area => {
            area.requirements.forEach(req => {
                data.controls[req.id] = getRequirementState(req.id);
            });
        });
        return data;
    }

    function applyStateObject(data) {
        if (!data) return;

        if (data.org) {
            document.getElementById("agencyName").value = data.org.agencyName || "";
            document.getElementById("ori").value = data.org.ori || "";
            document.getElementById("csa").value = data.org.csa || "";
            document.getElementById("assessmentDate").value = data.org.assessmentDate || "";
            document.getElementById("assessorName").value = data.org.assessorName || "";
            document.getElementById("assessorEmail").value = data.org.assessorEmail || "";
            document.getElementById("scopeNotes").value = data.org.scopeNotes || "";
            document.getElementById("assessmentType").value = data.org.assessmentType || "";
        }

        if (data.contacts) {
            document.getElementById("tacName").value = data.contacts.tacName || "";
            document.getElementById("tacContact").value = data.contacts.tacContact || "";
            document.getElementById("lasoName").value = data.contacts.lasoName || "";
            document.getElementById("lasoContact").value = data.contacts.lasoContact || "";
            document.getElementById("itLead").value = data.contacts.itLead || "";
            document.getElementById("itContact").value = data.contacts.itContact || "";
            setRadioValue("tacLasoDocs", data.contacts.tacLasoDocs || "");
            setRadioValue("localPolicy", data.contacts.localPolicy || "");
        }

        if (data.environment) {
            document.getElementById("approxUsers").value = data.environment.approxUsers || "";
            document.getElementById("cjisSystems").value = data.environment.cjisSystems || "";
            document.getElementById("environmentNotes").value = data.environment.environmentNotes || "";
        }

        if (data.risk) {
            document.getElementById("riskImmediate").value = data.risk.immediate || "";
            document.getElementById("riskShortTerm").value = data.risk.shortTerm || "";
            document.getElementById("riskLongTerm").value = data.risk.longTerm || "";
        }

        if (data.assessor) {
            document.getElementById("assessorNotes").value = data.assessor.notes || "";
        }

        if (data.controls) {
            Object.keys(data.controls).forEach(reqId => {
                const ctrl = data.controls[reqId];
                const statusEl = document.getElementById(`status-${reqId}`);
                const notesEl = document.getElementById(`notes-${reqId}`);
                if (statusEl) {
                    statusEl.value = (ctrl && ctrl.status) ? ctrl.status : "";
                    updateStatusPill(reqId, (ctrl && ctrl.status) ? ctrl.status : "");
                }
                if (notesEl) {
                    notesEl.value = (ctrl && ctrl.notes) ? ctrl.notes : "";
                }
            });
        }

        updateSummary();
        recalcSnapshot();
    }

    function downloadText(filename, text) {
        const blob = new Blob([text], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
    }

    function exportJSON() {
        const data = buildStateObject();
        const agency = (data.org && data.org.agencyName) ? data.org.agencyName.trim().replace(/[^a-z0-9\- ]/gi,'').replace(/\s+/g,'-') : 'agency';
        const date = (data.org && data.org.assessmentDate) ? data.org.assessmentDate : new Date().toISOString().slice(0,10);
        const filename = `cjis-v6-self-assessment_${agency}_${date}.json`;
        downloadText(filename, JSON.stringify(data, null, 2));
        showToast('Exported JSON (saved to your device).');
    }

    function importJSON(evt) {
        const file = evt && evt.target && evt.target.files ? evt.target.files[0] : null;
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
            try {
                const data = JSON.parse(reader.result);
                applyStateObject(data);
                localStorage.setItem(stateKey, JSON.stringify(data));
                const now = new Date();
                document.getElementById("lastUpdatedLabel").textContent = `Last updated: ${now.toLocaleString()}`;
                showToast('Imported JSON and restored session.');
            } catch (e) {
                showToast('Import failed: invalid JSON.');
            }
            evt.target.value = '';
        };
        reader.readAsText(file);
    }


    function initialize() {
        buildPolicyTabs();
        loadState();
        updateSummary();
        recalcSnapshot();
        attachRadioHandlers();
    }

    function buildPolicyTabs() {
        const tabContainer = document.getElementById("policyTabs");
        const contentContainer = document.getElementById("policyContent");
        tabContainer.innerHTML = "";
        contentContainer.innerHTML = "";

        cjisControls.policyAreas.forEach((area, index) => {
            const tab = document.createElement("div");
            tab.className = "tab" + (index === 0 ? " active" : "");
            tab.textContent = area.name;
            tab.dataset.areaId = area.id;
            tab.onclick = () => selectPolicyArea(area.id);
            tabContainer.appendChild(tab);

            const pane = document.createElement("div");
            pane.id = `policy-pane-${area.id}`;
            pane.style.display = index === 0 ? "block" : "none";

            const headerRow = document.createElement("div");
            headerRow.className = "flex-space";
            headerRow.style.marginBottom = "6px";

            const left = document.createElement("div");
            left.innerHTML = `
                <span class="pill-cjis">
                    <span class="pill-cjis-dot"></span>
                    <span class="pill-cjis-code">${area.code}</span>
                    <span class="pill-cjis-area">${area.description}</span>
                </span>
            `;
            headerRow.appendChild(left);

            const right = document.createElement("div");
            right.className = "phase-row";
            right.innerHTML = `
                <div class="phase-badge">
                    <span>‚áß</span> Capture status
                </div>
                <div class="phase-badge">
                    <span>‚òÖ</span> Note gaps
                </div>
                <div class="phase-badge">
                    <span>‚öô</span> Plan fixes
                </div>
            `;
            headerRow.appendChild(right);

            pane.appendChild(headerRow);

            area.requirements.forEach(req => {
                const row = document.createElement("div");
                row.className = "requirement-row";
                row.dataset.reqId = req.id;

                const header = document.createElement("div");
                header.className = "requirement-header";

                const title = document.createElement("div");
                title.className = "requirement-title";
                title.textContent = req.title;
                header.appendChild(title);

                const idTag = document.createElement("div");
                idTag.className = "requirement-id";
                idTag.textContent = req.id.toUpperCase();
                header.appendChild(idTag);

                const statusPill = document.createElement("div");
                statusPill.className = "pill-status pill-status-muted";
                statusPill.id = `status-pill-${req.id}`;
                statusPill.innerHTML = `
                    <div class="pill-status-dot"></div>
                    <span>Status: Not set</span>
                `;
                header.appendChild(statusPill);

                row.appendChild(header);

                const body = document.createElement("div");
                body.className = "requirement-body";

                const leftCol = document.createElement("div");
                leftCol.className = "requirement-notes";
                leftCol.innerHTML = `
                    <div class="help-text">
                        <strong>Summary:</strong> ${req.summary}
                    </div>
                    <div class="field-label" style="margin-top:4px;"><span>Assessor Notes</span></div>
                    <textarea id="notes-${req.id}" placeholder="${req.notesPlaceholder || ""}"></textarea>
                `;
                body.appendChild(leftCol);

                const rightCol = document.createElement("div");
                rightCol.className = "requirement-controls";

                const statusRow = document.createElement("div");
                statusRow.className = "status-row";
                statusRow.innerHTML = `
                    <select class="status-select" id="status-${req.id}" onchange="onStatusChange('${req.id}')">
                        <option value="">Set status‚Ä¶</option>
                        <option value="compliant">Compliant</option>
                        <option value="partial">Partially implemented</option>
                        <option value="non-compliant">Not implemented / major gap</option>
                        <option value="na">Not applicable</option>
                    </select>
                    <span class="pill-text">Use ‚ÄúPartial‚Äù for in-progress or limited implementation.</span>
                `;
                rightCol.appendChild(statusRow);

                const evidenceRow = document.createElement("div");
                evidenceRow.className = "evidence-tags";

                req.evidence.forEach(ev => {
                    const tag = document.createElement("div");
                    tag.className = "evidence-tag";
                    tag.innerHTML = `<strong>Evidence:</strong> ${ev}`;
                    evidenceRow.appendChild(tag);
                });

                rightCol.appendChild(evidenceRow);

                body.appendChild(rightCol);
                row.appendChild(body);

                pane.appendChild(row);
            });

            contentContainer.appendChild(pane);
        });
    }

    function selectPolicyArea(areaId) {
        document.querySelectorAll(".tab").forEach(tab => {
            tab.classList.toggle("active", tab.dataset.areaId === areaId);
        });

        cjisControls.policyAreas.forEach(area => {
            const pane = document.getElementById(`policy-pane-${area.id}`);
            if (pane) {
                pane.style.display = (area.id === areaId) ? "block" : "none";
            }
        });
    }

    function onStatusChange(reqId) {
        const status = document.getElementById(`status-${reqId}`).value;
        updateStatusPill(reqId, status);
        recalcSnapshot();
        updateSummary();
    }

    function updateStatusPill(reqId, status) {
        const pill = document.getElementById(`status-pill-${reqId}`);
        if (!pill) return;

        pill.className = "pill-status";
        let text = "Status: Not set";

        if (!status) {
            pill.classList.add("pill-status-muted");
        } else if (status === "compliant") {
            pill.classList.add("pill-status-ok");
            text = "Status: Compliant";
        } else if (status === "partial") {
            pill.classList.add("pill-status-warn");
            text = "Status: Partial / In-progress";
        } else if (status === "non-compliant") {
            pill.classList.add("pill-status-risk");
            text = "Status: Non-compliant / Gap";
        } else if (status === "na") {
            pill.classList.add("pill-status-muted");
            text = "Status: Not applicable";
        }

        pill.innerHTML = `
            <div class="pill-status-dot"></div>
            <span>${text}</span>
        `;
    }

    function getRequirementState(reqId) {
        const statusEl = document.getElementById(`status-${reqId}`);
        const notesEl = document.getElementById(`notes-${reqId}`);

        return {
            status: statusEl ? statusEl.value : "",
            notes: notesEl ? notesEl.value : ""
        };
    }

    function recalcSnapshot() {
        let total = 0;
        let withStatus = 0;
        let nonCompliant = 0;

        cjisControls.policyAreas.forEach(area => {
            area.requirements.forEach(req => {
                total++;
                const status = getRequirementState(req.id).status;
                if (status) withStatus++;
                if (status === "non-compliant") nonCompliant++;
            });
        });

        const pctComplete = total > 0 ? Math.round((withStatus / total) * 100) : 0;
        const pctRisk = total > 0 ? Math.round((nonCompliant / total) * 100) : 0;

        document.getElementById("metricComplete").textContent = `${withStatus} / ${total}`;
        document.getElementById("metricNonCompliant").textContent = nonCompliant.toString();
        document.getElementById("progressFill").style.width = `${pctComplete}%`;
        document.getElementById("riskFill").style.width = `${pctRisk}%`;

        const dot = document.getElementById("overallStatusDot");
        const label = document.getElementById("overallStatusLabel");
        const snapshotTag = document.getElementById("snapshotStatusTag");

        dot.className = "pill-dot";
        snapshotTag.className = "tag-soft neutral";

        if (withStatus === 0) {
            dot.classList.add("muted");
            label.textContent = "Not started";
            snapshotTag.textContent = "Not started";
        } else if (nonCompliant === 0 && pctComplete === 100) {
            dot.classList.add("success");
            label.textContent = "Green ‚Äì No non-compliant controls noted";
            snapshotTag.className = "tag-soft green";
            snapshotTag.textContent = "Green (no non-compliant controls)";
        } else if (nonCompliant === 0) {
            dot.classList.add("warning");
            label.textContent = "In progress ‚Äì No non-compliant controls yet";
            snapshotTag.className = "tag-soft yellow";
            snapshotTag.textContent = "In progress ‚Äì no red controls";
        } else if (nonCompliant <= 3) {
            dot.classList.add("warning");
            label.textContent = `Moderate risk ‚Äì ${nonCompliant} non-compliant controls`;
            snapshotTag.className = "tag-soft yellow";
            snapshotTag.textContent = `${nonCompliant} non-compliant controls`;
        } else {
            dot.classList.add("danger");
            label.textContent = `Elevated risk ‚Äì ${nonCompliant} non-compliant controls`;
            snapshotTag.className = "tag-soft red";
            snapshotTag.textContent = `Elevated risk ‚Äì ${nonCompliant} non-compliant controls`;
        }
    }

    function updateSummary() {
        const summaryGrid = document.getElementById("summaryGrid");
        summaryGrid.innerHTML = "";

        cjisControls.policyAreas.forEach(area => {
            const total = area.requirements.length;
            let compliant = 0, partial = 0, nonCompliant = 0, na = 0, pending = 0;

            area.requirements.forEach(req => {
                const status = getRequirementState(req.id).status;
                if (status === "compliant") compliant++;
                else if (status === "partial") partial++;
                else if (status === "non-compliant") nonCompliant++;
                else if (status === "na") na++;
                else pending++;
            });

            const completed = total - pending;
            const completionRate = total === 0 ? 0 : Math.round((completed / total) * 100);

            const card = document.createElement("div");
            card.className = "summary-card";
            card.innerHTML = `
                <h4>${area.name}</h4>
                <div>
                    <div class="summary-card-row">
                        <span>Compliant:</span>
                        <span style="color:#166534;">${compliant}</span>
                    </div>
                    <div class="summary-card-row">
                        <span>Partial:</span>
                        <span style="color:#854d0e;">${partial}</span>
                    </div>
                    <div class="summary-card-row">
                        <span>Non-Compliant:</span>
                        <span style="color:#b91c1c;">${nonCompliant}</span>
                    </div>
                    <div class="summary-card-row">
                        <span>N/A:</span>
                        <span style="color:#374151;">${na}</span>
                    </div>
                    <div class="summary-card-row">
                        <span>Pending:</span>
                        <span style="color:#0b61a4;">${pending}</span>
                    </div>
                    <div class="summary-completion">
                        Completion: ${completionRate}% (${completed}/${total} with a status)
                    </div>
                    <div class="progress-bar" style="margin-top:6px;">
                        <div class="progress-fill" style="width:${completionRate}%;"></div>
                    </div>
                </div>
            `;

            summaryGrid.appendChild(card);
        });
    }

    function saveState() {
        const data = buildStateObject();
        try {
            localStorage.setItem(stateKey, JSON.stringify(data));
            const now = new Date();
            const stamp = now.toLocaleString();
            document.getElementById("lastUpdatedLabel").textContent = `Last updated: ${stamp}`;
            showToast("Assessment state saved in this browser.");
        } catch (e) {
            showToast("Unable to save ‚Äì local browser storage may be disabled.");
        }
    }

    function loadState() {
        try {
            const raw = localStorage.getItem(stateKey);
            if (!raw) return;
            const data = JSON.parse(raw);

            if (data.org) {
                document.getElementById("agencyName").value = data.org.agencyName || "";
                document.getElementById("ori").value = data.org.ori || "";
                document.getElementById("csa").value = data.org.csa || "";
                document.getElementById("assessmentDate").value = data.org.assessmentDate || "";
                document.getElementById("assessorName").value = data.org.assessorName || "";
                document.getElementById("assessorEmail").value = data.org.assessorEmail || "";
                document.getElementById("scopeNotes").value = data.org.scopeNotes || "";
                document.getElementById("assessmentType").value = data.org.assessmentType || "";
            }

            if (data.contacts) {
                document.getElementById("tacName").value = data.contacts.tacName || "";
                document.getElementById("tacContact").value = data.contacts.tacContact || "";
                document.getElementById("lasoName").value = data.contacts.lasoName || "";
                document.getElementById("lasoContact").value = data.contacts.lasoContact || "";
                document.getElementById("itLead").value = data.contacts.itLead || "";
                document.getElementById("itContact").value = data.contacts.itContact || "";
                setRadioValue("tacLasoDocs", data.contacts.tacLasoDocs || "");
                setRadioValue("localPolicy", data.contacts.localPolicy || "");
            }

            if (data.environment) {
                document.getElementById("approxUsers").value = data.environment.approxUsers || "";
                document.getElementById("cjisSystems").value = data.environment.cjisSystems || "";
                document.getElementById("environmentNotes").value = data.environment.environmentNotes || "";
            }

            if (data.risk) {
                document.getElementById("riskImmediate").value = data.risk.immediate || "";
                document.getElementById("riskShortTerm").value = data.risk.shortTerm || "";
                document.getElementById("riskLongTerm").value = data.risk.longTerm || "";
            }

            if (data.assessor) {
                document.getElementById("assessorNotes").value = data.assessor.notes || "";
            }

            if (data.controls) {
                Object.keys(data.controls).forEach(reqId => {
                    const ctrl = data.controls[reqId];
                    const statusEl = document.getElementById(`status-${reqId}`);
                    const notesEl = document.getElementById(`notes-${reqId}`);
                    if (statusEl) {
                        statusEl.value = ctrl.status || "";
                        updateStatusPill(reqId, ctrl.status || "");
                    }
                    if (notesEl) {
                        notesEl.value = ctrl.notes || "";
                    }
                });
            }

        } catch (e) {
            console.error("Error loading state", e);
        }
    }

    function resetState() {
        if (!confirm("Clear all assessment inputs for this page in this browser?")) return;
        localStorage.removeItem(stateKey);
        location.reload();
    }

    function getRadioValue(name) {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        for (let r of radios) {
            if (r.checked) return r.value;
        }
        return "";
    }

    function setRadioValue(name, value) {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        radios.forEach(r => {
            r.checked = (r.value === value);
        });
    }

    let toastTimer = null;

    function showToast(message) {
        const toast = document.getElementById("toast");
        const text = document.getElementById("toastText");
        text.textContent = message;
        toast.classList.add("show");

        if (toastTimer) {
            clearTimeout(toastTimer);
        }
        toastTimer = setTimeout(() => {
            toast.classList.remove("show");
        }, 2800);
    }

    const controlModalContent = {
        governance: {
            title: "Suggested Governance Evidence (TAC / LASO / Local CJIS Policy)",
            body: `
                <p class="text-sm">
                    For Policy Areas 1, 2, 11, and 12, governance documentation is critical to show how the local
                    agency organizes CJIS responsibilities.
                </p>
                <h4>Core Governance Artifacts</h4>
                <ul>
                    <li>Formal TAC and LASO appointment letters or orders</li>
                    <li>Local CJIS Security Policy or SOPs referencing CJIS v6.0</li>
                    <li>Organizational chart highlighting CJIS-related roles</li>
                    <li>Role & responsibility matrix (TAC, LASO, IT, Records, Dispatch, Vendors)</li>
                </ul>
                <h4>Helpful Support Documents</h4>
                <ul>
                    <li>Meeting notes where CJIS topics are discussed with leadership</li>
                    <li>Communications from CSA or state CJIS office that have been incorporated locally</li>
                    <li>Any written tasking documents defining CJIS-related duties</li>
                </ul>
                <p class="text-sm mt-4">
                    <strong>Tip:</strong> Use a simple matrix listing CJIS functions down the left and the responsible role across the top
                    to make responsibilities clear and easy to review during audits.
                </p>
            `
        }
    };

    function openControlModal(key) {
        const cfg = controlModalContent[key];
        if (!cfg) return;

        document.getElementById("controlModalTitle").textContent = cfg.title;
        document.getElementById("controlModalBody").innerHTML = cfg.body;
        document.getElementById("controlModalBackdrop").style.display = "flex";
    }

    function closeControlModal() {
        document.getElementById("controlModalBackdrop").style.display = "none";
    }

    function attachRadioHandlers() {
        document.querySelectorAll('input[type="radio"]').forEach(r => {
            r.addEventListener("change", () => {
                recalcSnapshot();
            });
        });
    }

    document.addEventListener("DOMContentLoaded", initialize);
</script>
</body>
</html>
